function l(a){let e,t,s,n,r;return n=new Date(a),e=String(n.getDate()).padStart(2,"0"),t=String(n.getMonth()+1).padStart(2,"0"),s=n.getFullYear(),r=e+"/"+t+"/"+s,r}function i(a,e){let t=!0;$(a).find("input,select").each(function(){if($(this).val().trim()==="")return t=!1,!1}),$(e).prop("disabled",!t)}$("#barangmasuk").on("input",function(){i("#barangmasuk",".simpan_barang_masuk")});$("#filter_date").on("input",function(){i("#filter_date",".act_filter")});$(document).on("click","#add_item_list",function(a){a.preventDefault(),$("#barangmasuk").length>0&&$("#barangmasuk")[0].reset(),$("#brg_masuk").length>0&&$("#brg_masuk")[0].reset(),$(".modal-title span").text("Tambah Barang Masuk"),$(".modal-title i").removeClass("fas fa-edit").addClass("fas fa-plus-square"),$("#aksi_brg_masuk span").text("Simpan"),$("#aksi_brg_masuk i").removeClass("fas fa-edit").addClass("fas fa-save"),$("#barangmasuk").attr("action","/barang_masuk/store"),$("input[name='_method']").remove(),$(".simpan_barang_masuk").prop("disabled",!0)});$(document).on("click",".act_stok_close ,#act_stok_close,#act_close,#act_keluar",function(a){a.preventDefault(),$("#barangmasuk").length>0&&$("#barangmasuk")[0].reset(),$("#nama_barang").trigger("change"),$("#tipe_barang_masuk").trigger("change"),$("input[name='_method']").remove(),$("#barangmasuk").attr("action","#"),$("#brg_masuk").length>0&&$("#brg_masuk")[0].reset(),$("#preview").attr("src","assets/icon/iconupload.jpg"),$("#file-name").text("File not found"),$("#update_form_stok").length>0&&$("#update_form_stok")[0].reset(),$("#update_form_stok").attr("action","#")});$(document).on("change","#nama_barang",function(a){a.preventDefault();let t=$(this).find(":selected").data("id");$("#id_barang").val(t)});$("#jumlah_brg").on("input",function(){this.value=this.value.replace(/[^0-9]/g,"")});$(document).on("click","#add_item",function(a){a.preventDefault(),$(".simpan_barang_masuk").prop("disabled",!0),$("#form_item")[0].reset(),$("#brg_masuk").length>0&&$("#brg_masuk")[0].reset(),$("#barangmasuk").length>0&&$("#barangmasuk")[0].reset(),$("#filter_date").length>0&&$("#filter_date")[0].reset(),$(".modal-title span").text("Tambah Barang"),$(".modal-title i").removeClass("fas fa-edit").addClass("fas fa-box"),$("#aksi_brg_masuk span").text("Simpan"),$("#aksi_brg_masuk i").removeClass("fas fa-edit").addClass("fas fa-save"),$("#form_item").attr("action","/list-item/store"),$("input[name='_method']").remove()});$(document).on("click",".ubah_barang_masuk",function(a){a.preventDefault(),$(".simpan_barang_masuk").prop("disabled",!1);let e=$(this).data("id");$("#barangmasuk").length>0&&$("#barangmasuk")[0].reset(),$(".modal-title span").text("Ubah Data Barang Masuk"),$(".modal-title i").removeClass("fas fa-plus-square").addClass("fas fa-edit"),$("#aksi_brg_masuk span").text("Ubah"),$("#aksi_brg_masuk i").removeClass("fas fa-save").addClass("fas fa-edit"),$("#barangmasuk").prepend('<input type="hidden" name="_method" value="PUT">'),$("#barangmasuk").attr("action","/barang_masuk/update/"+e),$.getJSON("/barang_masuk/detail/"+e,function(t,s,n){$("#id_barang").val(t.result.id_barang),$("#tgl_brg_masuk").val(t.result.tgl_brg_masuk),$("#no_warehouse").val(t.result.no_warehouse),$("#nama_barang").val(t.result.nama_barang).trigger("change"),$("#tipe_barang_masuk").val(t.result.tipe_barang).trigger("change"),$("#asal_gdg").val(t.result.asal_gudang),$("#jumlah_brg").val(t.result.jumlah_barang),$("#posisi_brg_masuk").val(t.result.posisi).trigger("change"),$("#status").val(t.result.status),$("#konsumen").val(t.result.nama_konsumen).val()!=="-"?$("#konsumen").prop("readonly",!1):$("#konsumen").prop("readonly",!0)})});$(document).on("click","#selectAllItem",function(){$(".selected_").prop("checked",$(this).prop("checked"))});$(document).on("change",".selected_,#selectAllItem",function(){$(".selected_:checked").length>0?$("#delete_all_brg_masuk").prop("disabled",!1):$("#delete_all_brg_masuk").prop("disabled",!0)});$(document).on("click","#delete_all_brg_masuk",function(a){a.preventDefault();let e=$(".selected_:checked"),t=$('meta[name="csrf-token"]').attr("content");Swal.fire({title:"Apakah Anda yakin?",text:`${e.length} Item yang dipilih akan dihapus!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(s=>{if(s.isConfirmed)if(e.length>0){let n=e.map(function(){return $(this).data("id")}).get();$.ajax({url:"/delete/barang_masuk",type:"DELETE",data:{ids:n,_token:t},success:function(r){Swal.fire({position:"center",icon:"success",title:`${n.length} Item berhasil dihapus.`,showConfirmButton:!1,timer:1500}).then(()=>{location.reload()})},error:function(r){Swal.fire({icon:"error",title:"Terjadi kesalahan",text:"Saat menghapus item."})}})}else alert("Silakan pilih item yang ingin dihapus.")})});$(document).on("click",".hapus_brg_masuk",function(){let a=$(this).data("id"),e=$(this).data("date"),t=$(this).data("name-type"),s=$("#delete_items_"+a);Swal.fire({title:"Apakah kamu yakin?",text:`Barang tanggal ${l(e)} ${t} ini akan dihapus!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(n=>{n.isConfirmed&&s.submit()})});$(document).on("change","#status",function(a){a.preventDefault(),$(this).val()=="customer"?$("#konsumen").prop("readonly",!1).val(""):$("#konsumen").prop("readonly",!0).val("-")});$(document).on("input","#keyword_brg_masuk",function(a){a.preventDefault();let e=$(this).val();e===""?$("tbody").load(`/barang_masuk/search?query=${encodeURIComponent(e)}`,function(){window.history.pushState({},"","/barang_masuk")}):$("tbody").load("/barang_masuk/search?query="+encodeURIComponent(e),function(){$("tbody .nama_brg_masuk, .tipe_brg_masuk").each(function(){let t=$(this).text();if(e){let s=new RegExp("("+e+")","gi"),n=t.replace(s,'<span class="highlight">$1</span>');$(this).html(n)}else $(this).html(t)})})});$(document).on("change","#filter_brg_masuk",function(){let a=$(this).val();$("tbody").load("/barang_masuk/filter?limit="+a,function(e){$(this).html(e.table),$(".pagination").html(e.pagination)})});$(document).on("change","#import_brg_masuk",function(a){let e=a.target.files[0];if(e){let t=new FileReader;t.onload=function(s){$("#preview").attr("src","assets/icon/excel.png")},t.readAsDataURL(e)}$("#file-name").text(e.name)});$(document).on("click","#export_barang_masuk",function(a){a.preventDefault(),$("#barangmasuk").length>0&&$("#barangmasuk")[0].reset(),$("#brg_masuk").length>0&&$("#brg_masuk")[0].reset(),$("#filter_date").length>0&&$("#filter_date")[0].reset(),$(".modal-title span").text("Export File"),$(".modal-title i").removeClass("fas fa-edit"),$(".modal-title i").removeClass("fas fa-plus-square"),$(".modal-title i").addClass("fas fa-download")});$(document).on("click","#set_brg_masuk",function(a){a.preventDefault();let e=$("#start_date_brg_masuk").val(),t=$("#end_date_brg_masuk").val();$.ajax({type:"POST",url:"/barang_masuk/filter/date",data:{_token:$('meta[name="csrf-token"]').attr("content"),start_date:e,end_date:t},success:function(s){$("tbody").html(s),$(".pagination").html(s.pagination)},error:function(s){if(s.status===422){let n=s.responseJSON.errors,r="";n.start_date&&(r+=n.start_date[0]+"<br>"),n.end_date&&(r+=n.end_date[0]+"<br>"),Swal.fire({icon:"warning",title:"Validasi tanggal gagal",confirmButtonText:"OK"})}}})});$(document).on("click","#import_item_list",function(a){a.preventDefault(),$("#barangmasuk").length>0&&$("#barangmasuk")[0].reset(),$("#brg_masuk").length>0&&$("#brg_masuk")[0].reset(),$("#filter_date").length>0&&$("#filter_date")[0].reset(),$(".modal-title span").text("Upload File"),$(".modal-title i").removeClass("fas fa-edit"),$(".modal-title i").removeClass("fas fa-plus-square"),$(".modal-title i").addClass("fas fa-file-upload")});
